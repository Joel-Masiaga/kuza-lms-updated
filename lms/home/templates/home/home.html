{% extends 'home/base.html' %}
{% load static %}

{% block title %}Dashboard - Kuza Ndoto Academy{% endblock %}

{% block extra_css %}
<style>
  @media (prefers-reduced-motion: no-preference) {
    @keyframes wave-hand {
      0% { transform: rotate(0deg); }
      10% { transform: rotate(14deg); }
      20% { transform: rotate(-8deg); }
      30% { transform: rotate(14deg); }
      40% { transform: rotate(-4deg); }
      50% { transform: rotate(10deg); }
      60% { transform: rotate(0deg); }
      100% { transform: rotate(0deg); }
    }
    .wave-emoji {
      display: inline-block;
      transform-origin: 70% 70%;
      animation: wave-hand 2.5s ease-in-out infinite;
    }
  }
</style>
{% endblock %}

{% block content %}
<main class="flex-1 px-4 py-4 pb-20 sm:p-6 overflow-y-auto">
<!-- Banner -->
    <section class="bg-primary dark:bg-primary-dark p-6 rounded-lg shadow-lg mb-6 text-white relative overflow-hidden">
        <h1 class="text-2xl font-bold mb-2 relative z-10">
            Welcome Back,
            {% if user.is_authenticated %}
                {% with first_name=user.profile.first_name|default:user.first_name|default:'' %}
                    {{ first_name|default:user.email|truncatechars:20 }}! <span class="wave-emoji" aria-hidden="true">ðŸ‘‹</span>
                {% endwith %}
            {% else %}
                Guest! <span class="wave-emoji" aria-hidden="true">ðŸ‘‹</span>
            {% endif %}
        </h1>
        <p class="text-gray-100 mb-4 relative z-10">Let's make today productive!</p>

        <div class="relative z-10 grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
            <div>
                <span class="block text-xl font-bold">{{ in_progress_courses|length }}</span>
                <span class="block text-xs opacity-80">Courses in Progress</span>
            </div>
            <div>
                <span class="block text-xl font-bold">{{ completed_courses|length }}</span>
                <span class="block text-xs opacity-80">Completed</span>
            </div>
            <div>
                <span class="block text-xl font-bold">{{ user_points|default:0 }}</span>
                <span class="block text-xs opacity-80">Points Earned</span>
            </div>
            <div>
                <span class="block text-xl font-bold">{{ user_badges|default:0 }}</span>
                <span class="block text-xs opacity-80">Badges</span>
            </div>
        </div>

        <div class="absolute -bottom-10 -right-10 w-32 h-32 bg-white opacity-10 rounded-full"></div>
        <div class="absolute top-5 left-5 w-20 h-20 bg-white opacity-5 rounded-lg transform rotate-12"></div>
    </section>

    <!-- Continue Learning -->
    <section class="mb-8">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100">Continue Learning</h3>
            <a href="{% url 'courses' %}?filter=enrolled" class="text-primary hover:text-primary-dark dark:hover:text-primary-light text-sm font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary dark:focus-visible:ring-offset-gray-800 rounded p-1">
                View All <i class="fas fa-chevron-right ml-1 text-xs"></i>
            </a>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for course in in_progress_courses|slice:":3" %}
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden transition-shadow hover:shadow-lg">
                <div class="relative">
                    {% if course.image %}
                        <img src="{{ course.image.url }}" 
                             alt="{{ course.title }} Thumbnail" 
                             class="w-full h-40 object-cover" 
                             onerror="this.onerror=null; this.src='https://placehold.co/400x225/00878d/FFF?text={{ course.title.0|upper }}';">
                    {% else %}
                        <img src="https://placehold.co/400x225/00878d/FFF?text={{ course.title.0|upper }}" 
                             alt="{{ course.title }} Thumbnail" 
                             class="w-full h-40 object-cover">
                    {% endif %}
                    <span class="absolute top-2 left-2 bg-primary text-white text-xs font-bold px-2 py-1 rounded-md uppercase tracking-wider">In Progress</span>
                </div>

                <div class="p-4">
                    <h4 class="font-semibold text-primary-darker dark:text-primary-light text-base mb-1">{{ course.title }}</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">{{ course.description|striptags|truncatewords:10 }}</p>

                    <!-- Progress bar -->
                    <div class="mb-3">
                        <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-2 bg-primary rounded-full transition-all duration-500" style="width: {{ course.progress|default:50 }}%;"></div>
                        </div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">{{ course.progress|default:50 }}% Complete</p>
                    </div>

                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-500 dark:text-gray-400 flex items-center">
                            <i class="fas fa-layer-group text-primary mr-1"></i> {{ course.get_category_display }}
                        </span>
                        <a href="{% url 'course_detail' course.pk %}" class="bg-primary hover:bg-primary-dark text-white text-xs font-semibold py-1.5 px-3 rounded-md transition-colors">
                            Continue Learning â†’
                        </a>
                    </div>
                </div>
            </div>
            {% empty %}
                <p class="text-gray-600 dark:text-gray-400 sm:col-span-2 lg:col-span-3">
                    {% if user.is_authenticated %}
                        You have no courses in progress. <a href="{% url 'courses' %}" class="text-primary hover:underline">Explore all courses</a> to get started.
                    {% else %}
                        <a href="{% url 'login' %}" class="text-primary hover:underline">Login</a> to see your courses.
                    {% endif %}
                </p>
            {% endfor %}
        </div>
    </section>

    <!-- Explore More Courses -->
    <section>
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100">Explore More Courses</h3>
            <a href="{% url 'courses' %}" class="text-primary hover:text-primary-dark dark:hover:text-primary-light text-sm font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary dark:focus-visible:ring-offset-gray-800 rounded p-1">
                Browse Catalog <i class="fas fa-chevron-right ml-1 text-xs"></i>
            </a>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for course in all_courses|slice:":3" %}
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden transition-shadow hover:shadow-lg">
                <div class="relative">
                    {% if course.image %}
                        <img src="{{ course.image.url }}" 
                             alt="{{ course.title }} Thumbnail" 
                             class="w-full h-40 object-cover" 
                             onerror="this.onerror=null; this.src='https://placehold.co/400x225/00878d/FFF?text={{ course.title.0|upper }}';">
                    {% else %}
                        <img src="https://placehold.co/400x225/00878d/FFF?text={{ course.title.0|upper }}" 
                             alt="{{ course.title }} Thumbnail" 
                             class="w-full h-40 object-cover">
                    {% endif %}
                </div>
                <div class="p-4">
                    <h4 class="font-semibold text-primary-darker dark:text-primary-light text-base mb-1">{{ course.title }}</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">{{ course.description|striptags|truncatewords:10 }}</p>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-500 dark:text-gray-400 flex items-center">
                            <i class="fas fa-layer-group text-primary mr-1"></i> {{ course.get_category_display }}
                        </span>
                        <a href="{% url 'course_detail' course.pk %}" class="bg-primary hover:bg-primary-dark text-white text-xs font-semibold py-1.5 px-3 rounded-md transition-colors">
                            View Details
                        </a>
                    </div>
                </div>
            </div>
            {% empty %}
                <p class="text-gray-600 dark:text-gray-400 sm:col-span-2 lg:col-span-3">No courses are available at this time.</p>
            {% endfor %}
        </div>
    </section>
</main>
{% endblock %}
